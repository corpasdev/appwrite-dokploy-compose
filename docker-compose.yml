version: '3.8'

services:
  appwrite:
    image: appwrite/appwrite:1.7.0
    depends_on:
      - appwrite-mariadb
      - appwrite-redis
    environment:
      _APP_ENV: production
      _APP_OPENSSL_KEY_V1: ae817035ed941ac07a11e3a6a7d7493b7fc5bc93df429610baee44b037079959
      _APP_DOMAIN: appwrite-compose-app-t5qmlw-6ad8b3-173-212-225-43.traefik.me
      _APP_DOMAIN_TARGET: appwrite-compose-app-t5qmlw-6ad8b3-173-212-225-43.traefik.me
      _APP_DB_HOST: appwrite-mariadb
      _APP_DB_PORT: 3306
      _APP_DB_SCHEMA: appwrite
      _APP_DB_USER: root
      _APP_DB_PASS: StrongPass123!
      _APP_REDIS_HOST: appwrite-redis
      _APP_REDIS_PORT: 6379
    volumes:
      - appwrite-data:/storage
    networks:
      - appwrite-network
    restart: always

  appwrite-mariadb:
    image: mariadb:10.7
    environment:
      MYSQL_ROOT_PASSWORD: StrongPass123!
      MYSQL_DATABASE: appwrite
      MYSQL_ROOT_HOST: '%'
    volumes:
      - mariadb-data:/var/lib/mysql
    networks:
      - appwrite-network
    restart: always

  appwrite-redis:
    image: redis:7
    volumes:
      - redis-data:/data
    networks:
      - appwrite-network
    restart: always

volumes:
  appwrite-data:
  mariadb-data:
  redis-data:

networks:
  appwrite-network:
    driver: bridge
